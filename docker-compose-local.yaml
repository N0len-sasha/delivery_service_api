services:
    db:
      container_name: "delivery_db"
      image: postgres:16
      restart: always
      environment:
        - POSTGRES_USER=postgres
        - POSTGRES_PASSWORD=postgres
        - POSTGRES_DB=postgres
      ports:
        - "5430:5432"
      networks:
        - custom

    redis:
      container_name: "delivery_redis"
      image: redis:latest
      restart: always
      environment:
        - REDIS_HOST=localhost
        - REDIS_PORT=6379
        - REDIS_DB=0
        - REDIS_KEY=usd_to_rub_rate
        - REDIS_TTL=3600
      ports:
        - "6379:6379"
      networks:
        - custom

    app:
      container_name: "delivery_app"
      build:
        context: .
        dockerfile: Dockerfile
      restart: always
      ports:
        - "8000:8000"
      environment:
        - DATABASE_URL=postgresql://postgres:postgres@db:5432/postgres
        - REDIS_URL=redis://redis:6379/0
      depends_on:
        - db
        - redis
      networks:
        - custom

networks:
    custom:
      driver: bridge